{% extends 'store/base.html' %}
{% load static %}

{% block title %}בוטיק אריה - דף הבית{% endblock %}

{% block content %}
<!-- Hero Banner -->
{% if site_settings and site_settings.hero_banner %}
<section class="hero-banner">
    <div class="hero-image">
        <img src="{{ site_settings.hero_banner.url }}" alt="{{ site_settings.hero_title|default:'מוצרי תינוקות איכותיים' }}">
        {% if site_settings.hero_title or site_settings.hero_subtitle %}
        <div class="hero-content">
            {% if site_settings.hero_title %}
            <h1 class="hero-title">{{ site_settings.hero_title }}</h1>
            {% endif %}
            {% if site_settings.hero_subtitle %}
            <p class="hero-subtitle">{{ site_settings.hero_subtitle }}</p>
            {% endif %}
        </div>
        {% endif %}
    </div>
</section>
{% else %}
<!-- Default banner if no settings configured -->
<section class="hero-banner">
    <div class="hero-image">
        <img src="{% static 'images/hero-banner.jpg' %}" alt="מוצרי תינוקות איכותיים">
    </div>
</section>
{% endif %}

<!-- Categories Gallery -->
<section class="categories-gallery">
    <div class="container">
        <div class="categories-grid">
            {% for category in categories %}
            <a href="{% url 'category_detail' category.slug %}" class="category-card">
                <div class="category-image">
                    {% if category.image %}
                        <img src="{{ category.image.url }}" alt="{{ category.name }}">
                    {% else %}
                        <img src="https://via.placeholder.com/600x400/E8D5C4/333333?text={{ category.name|urlencode }}" alt="{{ category.name }}">
                    {% endif %}
                    <div class="category-overlay">
                        <h2 class="category-title">{{ category.name }}</h2>
                    </div>
                </div>
            </a>
            {% empty %}
            <!-- Fallback if no categories exist -->
            <p>אין קטגוריות זמינות</p>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Our Story Section -->
<section class="our-story-section">
    <!-- First div: Blue-gray background -->
    <div class="story-top-bg">
        <div class="container">
            <h2 class="story-title">הסיפור שלנו</h2>
            <p class="story-description">אריה בוטיק מעל 70 שנה של איכות, רכות ומזכרות ילדות</p>
            <a href="#" class="story-button">עוד עלינו</a>
        </div>
    </div>
    
    <!-- Second div: White background -->
    <div class="story-bottom-bg"></div>
    
    <!-- Third div: Absolute positioned gallery -->
    <div class="story-gallery">
        <div class="story-gallery-container">
            <div class="story-image-card">
                <div class="story-image-wrapper">
                    <img src="{% static 'images/100 כותנה.png' %}" alt="100% כותנה" class="story-image">
                </div>
                <p class="story-caption">100% כותנה</p>
            </div>
            <div class="story-image-card">
                <div class="story-image-wrapper">
                    <img src="{% static 'images/בד פרימיום.png' %}" alt="בד פרימיום" class="story-image">
                </div>
                <p class="story-caption">בד פרימיום</p>
            </div>
            <div class="story-image-card">
                <div class="story-image-wrapper">
                    <img src="{% static 'images/רכות 100 אחוז.png' %}" alt="100% רכות" class="story-image">
                </div>
                <p class="story-caption">100% רכות</p>
            </div>
            <div class="story-image-card">
                <div class="story-image-wrapper">
                    <img src="{% static 'images/הדפסים יחודיים.png' %}" alt="הדפסים ייחודיים" class="story-image">
                </div>
                <p class="story-caption">הדפסים ייחודיים</p>
            </div>
        </div>
    </div>
</section>

<!-- Bestseller Products Section -->
{% if bestseller_products %}
<section class="bestsellers-section">
    <div class="container">
        <h2 class="bestsellers-title">הכי נמכרים שלנו</h2>
        
        <div class="products-gallery">
            {% for product in bestseller_products %}
            <div class="product-card">
                <!-- Heart Icon -->
                <button type="button" class="product-heart-btn {% if product.id in wishlist_product_ids %}active{% endif %}" data-product-id="{{ product.id }}" aria-label="הוסף לרשימת משאלות">
                    {% if product.id in wishlist_product_ids %}
                        <img src="{% static 'images/hert icon fill.svg' %}" alt="לב" class="product-heart-icon">
                    {% else %}
                        <img src="{% static 'images/ALL_PHOTOS SERCH HAMBURGER_HEART copy.svg' %}" alt="לב" class="product-heart-icon">
                    {% endif %}
                </button>
                
                <a href="{% url 'product_detail' product.slug %}" class="product-card-link">
                    <div class="product-image-wrapper">
                        <!-- Product Image -->
                        {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-card-image">
                        {% else %}
                            <div class="product-card-placeholder">אין תמונה</div>
                        {% endif %}
                    </div>
                    
                    <div class="product-card-info">
                        {% if product.subcategory %}
                            <p class="product-card-subcategory">{{ product.subcategory.name }}</p>
                        {% endif %}
                        <p class="product-card-name">{{ product.name }}</p>
                        <p class="product-card-price">{{ product.price }} ש"ח</p>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Gallery Below Bestsellers Section -->
{% if below_bestsellers_gallery and below_bestsellers_gallery.right_image and below_bestsellers_gallery.left_image %}
<section class="below-bestsellers-gallery">
    <div class="gallery-images">
        <div class="gallery-image-wrapper">
            <img src="{{ below_bestsellers_gallery.right_image.url }}" alt="תמונה ימנית" class="gallery-image">
        </div>
        <div class="gallery-image-wrapper">
            <img src="{{ below_bestsellers_gallery.left_image.url }}" alt="תמונה שמאלית" class="gallery-image">
        </div>
    </div>
</section>
{% endif %}

<!-- Testimonials Carousel Section -->
{% if testimonials %}
<section class="testimonials-section">
    <div class="container">
        <h2 class="testimonials-title">מילים טובות</h2>
        
        <div class="testimonials-carousel">
            <button class="carousel-arrow carousel-arrow-prev" aria-label="המלצה קודמת">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            
            <div class="testimonials-wrapper">
                <div class="testimonials-track">
                    {% for testimonial in testimonials %}
                    <div class="testimonial-slide {% if forloop.first %}active{% endif %}">
                        <blockquote class="testimonial-quote">
                            <p class="testimonial-text">"{{ testimonial.quote }}"</p>
                            <footer class="testimonial-author">{{ testimonial.author }}</footer>
                        </blockquote>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <button class="carousel-arrow carousel-arrow-next" aria-label="המלצה הבאה">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </div>
</section>
{% endif %}

<!-- Instagram Gallery Section -->
{% if instagram_gallery %}
<section class="instagram-gallery-section">
    <div class="container">
        <h2 class="instagram-gallery-title">חפשו אותנו באינסטגרם</h2>
        
        <div class="instagram-gallery-grid">
            <a href="{{ instagram_gallery.instagram_url }}" target="_blank" rel="noopener noreferrer" class="instagram-gallery-item">
                <img src="{{ instagram_gallery.image_1.url }}" alt="Instagram 1" class="instagram-gallery-image">
            </a>
            <a href="{{ instagram_gallery.instagram_url }}" target="_blank" rel="noopener noreferrer" class="instagram-gallery-item">
                <img src="{{ instagram_gallery.image_2.url }}" alt="Instagram 2" class="instagram-gallery-image">
            </a>
            <a href="{{ instagram_gallery.instagram_url }}" target="_blank" rel="noopener noreferrer" class="instagram-gallery-item">
                <img src="{{ instagram_gallery.image_3.url }}" alt="Instagram 3" class="instagram-gallery-image">
            </a>
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Heart button click handler - Wishlist toggle
        const heartButtons = document.querySelectorAll('.product-heart-btn');
        heartButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                {% if not user.is_authenticated %}
                    // Redirect to login if not authenticated
                    window.location.href = '/users/login/?next={{ request.path }}';
                    return;
                {% endif %}
                
                const productId = this.getAttribute('data-product-id');
                const heartIcon = this.querySelector('.product-heart-icon');
                
                // Get CSRF token
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                                  document.querySelector('[name="csrfmiddlewaretoken"]')?.value ||
                                  '{{ csrf_token }}';
                
                if (!csrfToken) {
                    console.error('CSRF token not found');
                    return;
                }
                
                // Send AJAX request
                fetch(`/wishlist/toggle/${productId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Toggle heart button state and image
                        const heartIcon = this.querySelector('.product-heart-icon');
                        if (data.action === 'added') {
                            this.classList.add('active');
                            heartIcon.src = '/static/images/hert icon fill.svg';
                        } else {
                            this.classList.remove('active');
                            heartIcon.src = '/static/images/ALL_PHOTOS SERCH HAMBURGER_HEART copy.svg';
                        }
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });
        
        // Testimonials Carousel functionality
        const carousel = document.querySelector('.testimonials-carousel');
        if (carousel) {
            const track = carousel.querySelector('.testimonials-track');
            const slides = carousel.querySelectorAll('.testimonial-slide');
            const prevButton = carousel.querySelector('.carousel-arrow-prev');
            const nextButton = carousel.querySelector('.carousel-arrow-next');
            
            if (slides.length > 0) {
                let currentIndex = 0;
                let autoplayInterval;
                
                function showSlide(index) {
                    slides.forEach((slide, i) => {
                        slide.classList.remove('active');
                        if (i === index) {
                            slide.classList.add('active');
                        }
                    });
                }
                
                function nextSlide() {
                    currentIndex = (currentIndex + 1) % slides.length;
                    showSlide(currentIndex);
                }
                
                function prevSlide() {
                    currentIndex = (currentIndex - 1 + slides.length) % slides.length;
                    showSlide(currentIndex);
                }
                
                function startAutoplay() {
                    autoplayInterval = setInterval(nextSlide, 5000); // Change every 5 seconds
                }
                
                function stopAutoplay() {
                    clearInterval(autoplayInterval);
                }
                
                // Event listeners for arrows
                if (nextButton) {
                    nextButton.addEventListener('click', () => {
                        nextSlide();
                        stopAutoplay();
                        startAutoplay(); // Restart autoplay after manual navigation
                    });
                }
                
                if (prevButton) {
                    prevButton.addEventListener('click', () => {
                        prevSlide();
                        stopAutoplay();
                        startAutoplay(); // Restart autoplay after manual navigation
                    });
                }
                
                // Pause autoplay on hover
                carousel.addEventListener('mouseenter', stopAutoplay);
                carousel.addEventListener('mouseleave', startAutoplay);
                
                // Start autoplay
                startAutoplay();
            }
        }
    });
</script>
{% endblock %}

